#running kafka broker (using web image) within a container in a pod on eks
#broker should be able to connect to zk service already

ajuser:~/deployments2 $ vi kubernetes/kafka-docker.yaml 
ajuser:~/deployments2 $ kubectl apply -f kubernetes/kafka-docker.yaml 
deployment.apps/kafka-broker0 created

juser:~/deployments2 $ kubectl get pods
NAME                             READY   STATUS    RESTARTS   AGE
kafka-broker0-766479dc64-49rcb   1/1     Running   0          41s
zk-0                             1/1     Running   0          3m56s
zk-1                             1/1     Running   0          3m17s
zk-2                             1/1     Running   0          2m40s

ajuser:~/deployments2 $ kubectl exec -it kafka-broker0-766479dc64-49rcb /bin/bash
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
bash-5.1# kafka-topics.sh --list --zookeeper zk-hs:2181
admintome-test

ajuser:~/deployments2 $ kubectl describe pod kafka-broker0-766479dc64-49rcb
Name:         kafka-broker0-766479dc64-49rcb
Namespace:    default
Priority:     0
Node:         ip-192-168-88-127.eu-central-1.compute.internal/192.168.88.127
Start Time:   Wed, 25 Aug 2021 09:55:33 +0000
Labels:       app=kafka
              id=0
              pod-template-hash=766479dc64
Annotations:  kubernetes.io/psp: eks.privileged
Status:       Running
IP:           192.168.89.121
IPs:
  IP:           192.168.89.121
Controlled By:  ReplicaSet/kafka-broker0-766479dc64
Containers:
  kafka:
    Container ID:   docker://690ed302566c5116902086ebb2e7d3891f41b826002c2ab04840802e0c291c53
    Image:          wurstmeister/kafka
    Image ID:       docker-pullable://wurstmeister/kafka@sha256:4bad02cf8f07d0bf65d5cc73cce7aa75f9a90e32b585f867fce7c3fff229bd6d
    Port:           9092/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Wed, 25 Aug 2021 09:55:43 +0000
    Ready:          True
    Restart Count:  0
    Environment:
      KAFKA_ADVERTISED_PORT:       30718
      KAFKA_ADVERTISED_HOST_NAME:  localhost
      KAFKA_ZOOKEEPER_CONNECT:     zk-hs:2181
      KAFKA_BROKER_ID:             0
      KAFKA_CREATE_TOPICS:         admintome-test:1:1
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-2z6xm (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  default-token-2z6xm:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-2z6xm
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age    From               Message
  ----    ------     ----   ----               -------
  Normal  Scheduled  7m28s  default-scheduler  Successfully assigned default/kafka-broker0-766479dc64-49rcb to ip-192-168-88-127.eu-central-1.compute.internal
  Normal  Pulling    7m27s  kubelet            Pulling image "wurstmeister/kafka"
  Normal  Pulled     7m19s  kubelet            Successfully pulled image "wurstmeister/kafka" in 8.000591219s
  Normal  Created    7m18s  kubelet            Created container kafka
  Normal  Started    7m18s  kubelet            Started container kafka
